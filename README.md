# Лабораторная работа №4

## Симуляция с пользовательскими коллекциями и псевдослучайной моделью

### Введение

Лабораторная работа №4 посвящена разработке программы-симулятора работы библиотеки с использованием пользовательских коллекций и псевдослучайной модели. Задание направлено на закрепление навыков объектно-ориентированного программирования, работы с абстрактными классами, магическими методами Python и созданием воспроизводимых симуляций.

В рамках задания реализуется система управления библиотекой книг с поддержкой различных операций поиска, добавления и удаления. Все операции выполняются через пользовательские коллекции данных, которые поддерживают стандартные протоколы Python (итерирование, индексирование, срезы).

В данной реализации программа поддерживает:

**Пользовательские коллекции:**

- `BookCollection` — списковая коллекция на основе композиции:
  - `__iter__()` — итерирование по книгам
  - `__len__()` — получение количества книг
  - `__getitem__()` — доступ по индексу и срезам
  - `__add__()` — сложение коллекций
  - `__contains__()` — проверка наличия книги
  - `__eq__()` — сравнение коллекций по содержимому
  - `__repr__()` — представление для отладки
  - `add()` — добавление книги
  - `remove()` — удаление книги

- `IndexDict` — словарная коллекция для индексации:
  - Индексация по ISBN
  - Индексация по автору
  - Индексация по году издания
  - `__getitem__()` — доступ по кортежу (тип, значение)
  - `__contains__()` — проверка наличия по ISBN или объекту Book
  - `__eq__()` — сравнение индексов по содержимому
  - `__repr__()` — представление для отладки
  - `add_book()` — добавление книги во все индексы
  - `remove_book()` — удаление книги из всех индексов

**Предметная модель:**

- `Book` — класс книги с полями:
  - `title` — название
  - `author` — автор
  - `year` — год издания
  - `genre` — жанр
  - `isbn` — уникальный идентификатор
  - `__eq__()` — сравнение по ISBN
  - `__repr__()` — представление для отладки

- `Library` — класс библиотеки:
  - `add_book()` — добавление книги с проверкой дубликатов ISBN
  - `remove_book()` — удаление книги
  - `search_by_isbn()` — поиск по ISBN O(1)
  - `search_by_author()` — поиск всех книг автора O(1)
  - `search_by_year()` — поиск всех книг по году O(1)
  - `search_by_genre()` — поиск всех книг жанра O(n)
  - `get_random_book()` — получение случайной книги O(1)

**Псевдослучайная симуляция:**

- `run_simulation(steps, seed)` — выполнение симуляции:
  - Воспроизводимость при задании `seed`
  - Случайный выбор событий на каждом шаге
  - Логирование всех операций в консоль
  - Обработка ошибок и edge cases

**События симуляции:**
- Добавление новой книги в библиотеку
- Удаление случайной книги
- Поиск книг по автору
- Поиск книг по жанру
- Поиск книг по году издания
- Поиск несуществующей книги (проверка обработки)

**Дополнительные возможности:**

- Интерактивное CLI-меню для ручного управления библиотекой
- Загрузка начальных данных из JSON
- Валидация на дубликаты ISBN
- Синхронизация между коллекцией и индексами
- Полное покрытие unit-тестами

---

## Как запускать

### Установка виртуального окружения

```bash
python -m venv venv
```

**Активация:**

- для Windows: `venv\Scripts\activate`
- для macOS и Unix: `source venv/bin/activate`

### Клонирование и установка

```bash
git clone <your-repository-url>
cd lab_4
pip install -r requirements.txt
```

### Запуск программы

```bash
python src/main.py
```

Для выхода из программы выберите пункт 0 в главном меню или нажмите `Ctrl+C`.

### Запуск симуляции

Симуляцию также можно запустить напрямую:

```bash
python -c "from src.simulation import run_simulation; run_simulation(steps=20, seed=42)"
```

---

## Расположение основных файлов

В папке `src` лежат файлы с реализацией задачи заданной в лабораторной работе. Обязательным файлом является файл `main.py`, в котором описана точка входа в приложение - функция `main`.

**Основные модули:**

**Предметная область:**
- `book.py` — класс `Book` с магическими методами `__eq__`, `__repr__`, `__str__`
- `library.py` — класс `Library` для управления коллекцией книг и индексами

**Пользовательские коллекции:**
- `book_collections.py` — классы:
  - `BaseCollection` — абстрактный базовый класс
  - `BookCollection` — списковая коллекция на основе композиции
  - `IndexDict` — словарная коллекция для индексации

**Симуляция:**
- `simulation.py` — функция `run_simulation()` и обработчики событий:
  - `_event_add_book()` — добавление книги
  - `_event_remove_book()` — удаление книги
  - `_event_search_by_author()` — поиск по автору
  - `_event_search_by_genre()` — поиск по жанру
  - `_event_search_by_year()` — поиск по году
  - `_event_search_nonexistent()` — поиск несуществующей книги

**Данные и утилиты:**
- `constants.py` — загрузка данных из JSON, константы
- `books_data.json` — начальный набор из 20 книг русской литературы

**Интерфейс:**
- `main.py` — точка входа, интерактивное CLI-меню

В папке `tests` лежат pytest тесты. Для каждого модуля есть отдельный файл с тестами:

- `test_book.py` — тесты для класса `Book`
- `test_book_collections.py` — тесты для `BookCollection` и `IndexDict`
- `test_library.py` — тесты для класса `Library`
- `test_simulation.py` — тесты для симуляции
- `test_constants.py` — тесты для загрузки данных


---

## Структура проекта

```
lab_4/
├── src/
│   ├── __init__.py
│   ├── main.py
│   ├── book.py
│   ├── library.py
│   ├── book_collections.py
│   ├── simulation.py
│   ├── constants.py
│   └── books_data.json
│
├── tests/
│   ├── __init__.py
│   ├── test_book.py
│   ├── test_book_collections.py
│   ├── test_library.py
│   ├── test_simulation.py
│   └── test_constants.py
│
├── .gitignore
├── pyproject.toml
├── README.md
├── requirements.txt
└── uv.lock
```

---



## Запуск тестов

```bash
pytest tests/ -v
```
